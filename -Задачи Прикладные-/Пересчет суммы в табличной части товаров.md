#ФОРМЫ 
### Задача:
При изменении количества или цены товара, должен осуществляться пересчет суммы
![[Pasted image 20240824230135.png]]
### Решение:
1. Создаем форму документа "РасходнаяНакладная"
2. Создаем события "ПриИзменении" для следующих элементов формы:
- "ВидЦен"
- "ТоварыНоменклатура"
- "ТоварыКоличество"
- "ТоварыЦена"
- "ТоварыСтавкаНДС"
![[Pasted image 20240824230921.png]]
![[Pasted image 20240824231021.png]]
![[Pasted image 20240824231056.png]]
![[Pasted image 20240824231134.png]]
![[Pasted image 20240824231203.png]]
3. Код модуля формы:
```bsl

//======================================================================
// Процедуры-обработчики событий

&НаКлиенте
Процедура ВидЦенПриИзменении(Элемент)
	ПересчитатьЦеныИСуммыТоваров();
КонецПроцедуры

&НаКлиенте
Процедура ТоварыНоменклатураПриИзменении(Элемент)
	Товар						= Элементы.Товары.ТекущиеДанные;
	Товар.СтавкаНДС	= ПолучитьРеквизитыНоменклатуры(Товар.Номенклатура).СтавкаНДС;
	Товар.Цена				= ЦенаТовара(Товар.Номенклатура, Объект.ВидЦен, Объект.Дата);
	РассчитатьСуммы(Товар);
КонецПроцедуры

&НаКлиенте
Процедура ТоварыКоличествоПриИзменении(Элемент)
	РассчитатьСуммы(Элементы.Товары.ТекущиеДанные);
КонецПроцедуры

&НаКлиенте
Процедура ТоварыЦенаПриИзменении(Элемент)
	РассчитатьСуммы(Элементы.Товары.ТекущиеДанные);
КонецПроцедуры

&НаКлиенте
Процедура ТоварыСтавкаНДСПриИзменении(Элемент)
	РассчитатьСуммы(Элементы.Товары.ТекущиеДанные);
КонецПроцедуры


//======================================================================
// Служебные процедуры и функции
&НаКлиенте
Процедура ПересчитатьЦеныИСуммыТоваров()
	Для каждого Товар Из Объект.Товары Цикл
		Товар.Цена = ЦенаТовара(Товар.Номенклатура, Объект.ВидЦен, Объект.Дата);
		РассчитатьСуммы(Товар);
	КонецЦикла;
КонецПроцедуры

&НаСервереБезКонтекста
Функция ЦенаТовара(Номенклатура, ВидЦены, Дата)
	Отбор = Новый Структура("Номенклатура, ВидЦен", Номенклатура, ВидЦены);
	Возврат РегистрыСведений.ЦеныНоменклатуры.ПолучитьПоследнее(Дата, Отбор).Цена;
КонецФункции

&НаКлиенте
Процедура РассчитатьСуммы(Товар)
	НДСЧислом					= НДСЧислом(Товар.СтавкаНДС);
	Товар.Сумма				= Товар.Количество * Товар.Цена;
	Товар.СуммаНДС		= Товар.Сумма * НДСЧислом / 100;
	Товар.СуммаВсего		= Товар.Сумма + Товар.СуммаНДС;
КонецПроцедуры

&НаСервере
Функция НДСЧислом(СтавкаНДС)
	СтавкиНДС = Новый Соответствие;
	СтавкиНДС.Вставить(Перечисления.СтавкиНДС.БезНДС, 0);
	СтавкиНДС.Вставить(Перечисления.СтавкиНДС.НДС0,    0);
	СтавкиНДС.Вставить(Перечисления.СтавкиНДС.НДС10, 10);
	СтавкиНДС.Вставить(Перечисления.СтавкиНДС.НДС18, 18);
	СтавкиНДС.Вставить(Перечисления.СтавкиНДС.НДС20, 20);
	Возврат СтавкиНДС.Получить(СтавкаНДС);
КонецФункции

&НаСервереБезКонтекста
Функция ПолучитьРеквизитыНоменклатуры(НоменклатураСсылка)
	
	НоменклатураОбъект = НоменклатураСсылка.ПолучитьОбъект();
	РеквизитыСправочникаНоменклатура = Метаданные.Справочники.Номенклатура.Реквизиты;
	СтруктураРезультат = Новый Структура;
	
	Для каждого Реквизит Из РеквизитыСправочникаНоменклатура Цикл
		СтруктураРезультат.Вставить(Реквизит.Имя, НоменклатураОбъект[Реквизит.Имя]);
	КонецЦикла;
	
	Возврат СтруктураРезультат;
	
КонецФункции
```