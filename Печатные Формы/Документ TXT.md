### Задача:
Для документа "Расходная накладная", требуется разработать печатную форму и создать команду для печати "Чек ККМ", в командной панели документа
![[Pasted image 20240901110530.png]]

### Решение:
#### Команда:
1. Создаем команду "ПечатьЧекККМ" для документа "РасходнаяНакладная"
2. Свойства команды:
- Группа (Командная панель формы.Печать)
- Тип параметра команды (ДокументСсылка.РасходнаяНакладная)
- Режим использования команды (Одиночный)
- Изменяет данные (Нет)
![[Pasted image 20240901110800.png]]
3. Модуль команды:
```bsl
&НаКлиенте
Процедура ОбработкаКоманды(ПараметрКоманды, ПараметрыВыполненияКоманды)
	ТекстовыйДокумент = Новый ТекстовыйДокумент;
	ОбработкаКомандыНаСервере(ТекстовыйДокумент, ПараметрКоманды);
	ТекстовыйДокумент.Показать("Чек ККМ");
КонецПроцедуры

&НаСервере
Процедура ОбработкаКомандыНаСервере(ТекстовыйДокумент, ПараметрКоманды)
	Документы.РасходнаяНакладная.СформироватьЧекККМ(ТекстовыйДокумент, ПараметрКоманды);
КонецПроцедуры
```
#### Макет:
1. Создаем макет "ПФTXTЧекККМ" тип (Текстовый Документ)
![[Pasted image 20240901111012.png]]
```bsl

#Область Шапка				
				Чек ККМ_Практика
Номер: [Номер           ]
Дата: [Дата           ]
Контрагент: [Контрагент                         ]
#КонецОбласти


#Область ШапкаТаблицы
------------------------------------------------------------------
Товар                 | Количество, шт. | Цена, руб. | Сумма, руб.
------------------------------------------------------------------  
#КонецОбласти  


#Область СтрокаТаблицы
[Номенклатура        ]|[     Количество]|[      Цена]|[     Сумма] 
#КонецОбласти


#Область Итоги
------------------------------------------------------------------
				Итого: [ИтогоКоличество]|            |[ИтогоСумма]    
#КонецОбласти				
```

#### Модуль менеджера:
1. Открываем модуль менеджера документа "РасходнаяНакладная"
![[Pasted image 20240901105406.png]]
2. Создаем процедуру для формирование табличного документа
```bsl
Процедура СформироватьЧекККМ(ТекстовыйДокумент, Ссылка) Экспорт

	Запрос = Новый Запрос;
	Запрос.Текст = 
		"ВЫБРАТЬ
		|	РасходнаяНакладная.Номер КАК			Номер,
		|	РасходнаяНакладная.Дата КАК				Дата,
		|	РасходнаяНакладная.Контрагент КАК	Контрагент,
		|	РасходнаяНакладная.Товары.(
		|		Номенклатура КАК							Номенклатура,
		|		Количество КАК								Количество,
		|		Цена КАК											Цена,
		|		Сумма КАК										Сумма
		|	) КАК Товары
		|ИЗ
		|	Документ.РасходнаяНакладная КАК РасходнаяНакладная
		|ГДЕ
		|	РасходнаяНакладная.Ссылка = &Ссылка";
	Запрос.УстановитьПараметр("Ссылка", Ссылка);
	
	Выборка = Запрос.Выполнить().Выбрать();
	Выборка.Следующий();
	
	Макет = Документы.РасходнаяНакладная.ПолучитьМакет("ПФ_TXT_ЧекККМ");
	
	Область = Макет.ПолучитьОбласть("Шапка");
	Область.Параметры.Заполнить(Выборка);
	ТекстовыйДокумент.Вывести(Область);
	
	Область = Макет.ПолучитьОбласть("ШапкаТаблицы");
	Текст.Вывести(Область);

	ИтогоКоличество = 0;
	ИтогоСумма = 0;
	
	ВыборкаТовары = Выборка.Товары.Выбрать();
	Пока ВыборкаТовары.Следующий() Цикл
		Область = Макет.ПолучитьОбласть("СтрокаТаблицы");
		Область.Параметры.Заполнить(ВыборкаТовары);
	    ТекстовыйДокумент.Вывести(Область);
		ИтогоКоличество = ИтогоКоличество + ВыборкаТовары.Количество;
		ИтогоСумма = ИтогоСумма + ВыборкаТовары.Сумма;
	КонецЦикла; 
	
	Область = Макет.ПолучитьОбласть("Итоги");
	Область.Параметры.ИтогоКоличество = ИтогоКоличество;
	Область.Параметры.ИтогоСумма = ИтогоСумма;
	
	ТекстовыйДокумент.Вывести(Область);

КонецПроцедуры
```