#ОТЧЕТЫ #TODO 

Хрусталева (Отчеты) => Страница 416

---
### Задача:
Предположим, что пользователь, обладающий административными правами, является достаточно квалифицированным и может создавать различные варианты и настройки отчетов. Предоставим ему возможность копировать эти настройки другим рядовым пользователям.

### Решение:
1. Создадим общую команду **КопироватьНастройкиОтчетов** и укажем группу *Сервис* в панели действий приложения, в которой она будет отображаться
![[Pasted image 20240924041131.png]]
2. В диалоге Командный интерфейс рабочего стола предоставим доступ к этой команде только пользователю с ролью *Администратор*
![[Pasted image 20240924041243.png]]
3. Модуль команды:
```bsl
&НаКлиенте
Процедура ОбработкаКоманды(ПараметрКоманды, ПараметрыВыполненияКоманды)
	СкопироватьНастройкиОтчетов();
КонецПроцедуры

Процедура СкопироватьНастройкиОтчетов()
	СписокПользователей = ПользователиИнформационнойБазы.ПолучитьПользователей();
	СписокОтчетов = Метаданные.Отчеты;
	Для Каждого Пользователь Из СписокПользователей Цикл
		ТекущийПользователь = Пользователь.Имя;
		Если ТекущийПользователь <> ИмяПользователя() Тогда
			Сообщить("Копирование настроек для пользователя: " + ТекущийПользователь);
			Для Каждого Отчет Из СписокОтчетов Цикл
				ИмяОтчета = "Отчет." + Отчет.Имя;
				СписокВариантовОтчета = ХранилищеВариантовОтчетов.ПолучитьСписок(ИмяОтчета);
				Для Каждого Вариант Из СписокВариантовОтчета Цикл
					КлючВарианта = Вариант.Значение;
					Сообщить("Вариант отчета: " + Вариант.Представление);
					ОписаниеВарианта = ХранилищеВариантовОтчетов.
					ПолучитьОписание(ИмяОтчета, КлючВарианта);
					// Сообщить(ОписаниеВарианта.Представление);
					ВариантОтчета = ХранилищеВариантовОтчетов.
					Загрузить(ИмяОтчета, КлючВарианта);
					ХранилищеВариантовОтчетов.Сохранить(ИмяОтчета, КлючВарианта,
					ВариантОтчета, ОписаниеВарианта,
					ТекущийПользователь);
				КонецЦикла;
				КлючВариантаОтчета = ИмяОтчета + "/"+ КлючВарианта;
				СписокНастроекВарианта = ХранилищеПользовательскихНастроекОтчетов.
				ПолучитьСписок(КлючВариантаОтчета);
				Для Каждого Настройка Из СписокНастроекВарианта Цикл
					КлючНастройкиВарианта = Настройка.Значение;
					Сообщить("Пользовательская настройка:" + Настройка.Представление);
					ОписаниеНастройкиВарианта = ХранилищеПользовательскихНастроекОтчетов.
					ПолучитьОписание(КлючВариантаОтчета,
					КлючНастройкиВарианта);
					// Сообщить(ОписаниеНастройкиВарианта.Представление);
					НастройкаВариантаОтчета = ХранилищеПользовательскихНастроекОтчетов.
					Загрузить(КлючВариантаОтчета, КлючНастройкиВарианта);
					ХранилищеПользовательскихНастроекОтчетов.
					Сохранить(КлючВариантаОтчета, КлючНастройкиВарианта,
					НастройкаВариантаОтчета, ОписаниеНастройкиВарианта,
					ТекущийПользователь);
				КонецЦикла;
			КонецЦикла;
		КонецЕсли;
	КонецЦикла;
КонецПроцедуры
```
