#ОТЧЕТЫ 
### Задача:
Требуется соединить две таблицы **ОстаткиТоваров** и **ПродажиТоваров**
Если отчет получен с использованием связи двух таблиц в запросе, общий итог будет содержать суммы по всем строкам, что неверно
### Неправильное решение:
1. Создаем отчет **ОстаткиИПродажи_НеправильныйРасчетИтогов**
2. Создаем и открываем макет **ОсновнаяСхемаКомпоновкиДанных**
3. Добавляем набор данных **Запрос**. Текст запроса:
```bsl
ВЫБРАТЬ
	ТоварыНаСкладахОстатки.Номенклатура КАК Номенклатура,
	ТоварыНаСкладахОстатки.Склад КАК Склад,
	ТоварыНаСкладахОстатки.КоличествоОстаток КАК КоличествоОстаток,
	ПродажиОбороты.Контрагент КАК Контрагент,
	ПродажиОбороты.КоличествоОборот КАК КоличествоОборот,
	ПродажиОбороты.СуммаОборот КАК СуммаОборот
ИЗ
	РегистрНакопления.ТоварыНаСкладах.Остатки КАК ТоварыНаСкладахОстатки
		ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.Продажи.Обороты КАК ПродажиОбороты
		ПО ТоварыНаСкладахОстатки.Номенклатура = ПродажиОбороты.Номенклатура
```
4. Определяем ресурсы
![[Pasted image 20240923035306.png]]
5. Вкладка **Настройки** => Определяем структуру отчета и выбранные поля
![[Pasted image 20240923035400.png]]
6. Вкладка **Отбор** => Добавляем отбор по *Номенклатуре* в пользовательские настройки
![[Pasted image 20240923035503.png]]
7. Настройки => Другие настройки => Макет оформления => **Античный**

Итоговые значения содержат суммы по всем строкам. В данном случае – это **неверный** результат.
  ![[Pasted image 20240923034737.png]]
### Правильное решение:
1. Создаем отчет **ОстаткиИПродажи_ПравильныйРасчетИтогов**
2. Создаем и открываем макет **ОсновнаяСхемаКомпоновкиДанных**
3. Добавляем первый набор данных **Запрос**. Текст запроса:
```bsl
ВЫБРАТЬ
	ТоварыНаСкладахОстатки.Номенклатура КАК Номенклатура,
	ТоварыНаСкладахОстатки.Склад КАК Склад,
	ТоварыНаСкладахОстатки.КоличествоОстаток КАК КоличествоОстаток
ИЗ
	РегистрНакопления.ТоварыНаСкладах.Остатки КАК ТоварыНаСкладахОстатки
```
4. Добавляем второй набор данных **Запрос**. Текст запроса:
```bsl
ВЫБРАТЬ
	ПродажиОбороты.Контрагент КАК Контрагент,
	ПродажиОбороты.Номенклатура КАК Номенклатура,
	ПродажиОбороты.КоличествоОборот КАК КоличествоОборот,
	ПродажиОбороты.СуммаОборот КАК СуммаОборот
ИЗ
	РегистрНакопления.Продажи.Обороты КАК ПродажиОбороты
```
5. Связываем наборы данных по полю **Номенклатура**
![[Pasted image 20240923040518.png]]
6. Определяем ресурсы
![[Pasted image 20240923035306.png]]
7. Вкладка **Настройки** => Определяем структуру отчета и выбранные поля
![[Pasted image 20240923035400.png]]
6. Вкладка **Отбор** => Добавляем отбор по *Номенклатуре* в пользовательские настройки
![[Pasted image 20240923035503.png]]
7. Настройки => Другие настройки => Макет оформления => **Античный**

За счет соединения записи из обоих наборов данных выводятся в результат по нескольку раз. 
Однако общий итог по таблице рассчитан **Правильно** за счет того, что в расчете итогов каждая запись участвует только один раз.
 ![[Pasted image 20240923040240.png]]