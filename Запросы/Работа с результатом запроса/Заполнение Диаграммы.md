#ЗАПРОСЫ
### Задача:
Требуется создать форму обработки, в которой будет отображаться диаграмма сумма оборотов продаж товаров в разрезе контрагентов.
![[Pasted image 20240902144822.png]]
### Решение:
1. Создаем обработку и форму обработки
2. Создаем реквизит "Диаграмма" тип (Диаграмма). Переносим его на форму
![[Pasted image 20240902143402.png]]
3. Создаем команду "ЗаполнитьДиаграмму". Переносим ее на форму
4. Создаем обработчик действия команды.
![[Pasted image 20240902143629.png]]
5. Вызываем контекстное меню внутри процедуры => Конструктор запроса с обработкой результата
![[Pasted image 20240902143806.png]]
6. Обработка результата => Тип обработки => Вывод в диаграмму
![[Pasted image 20240902143912.png]]
7. Таблицы и поля => Продажи.Обороты => "Контрагент", "Номенклатура", "СуммаОборот"
![[Pasted image 20240902144055.png]]
8. Итоги => Группировочное поле => "Номенклатура" и "Контрагент"
9. Итоги => Итоговое поле => "СуммаОборот"
10. Жмем "ОК"
![[Pasted image 20240902144343.png]]
11. Модуль формы:
```bsl
&НаСервереБезКонтекста
Процедура ЗаполнитьДиаграммуНаСервере(Диаграмма)
	
	Запрос = Новый Запрос;
	Запрос.Текст = 
		"ВЫБРАТЬ
		|	ПродажиОбороты.Контрагент КАК										Контрагент,
		|	ПРЕДСТАВЛЕНИЕ(ПродажиОбороты.Контрагент) КАК			КонтрагентПредставление,
		|	ПродажиОбороты.Номенклатура КАК									Номенклатура,
		|	ПРЕДСТАВЛЕНИЕ(ПродажиОбороты.Номенклатура) КАК		НоменклатураПредставление,
		|	ПродажиОбороты.СуммаОборот КАК									СуммаОборот
		|ИЗ
		|	РегистрНакопления.Продажи.Обороты КАК						ПродажиОбороты
		|ИТОГИ
		|	СУММА(СуммаОборот)
		|ПО
		|	Номенклатура,
		|	Контрагент";
	
	РезультатЗапроса = Запрос.Выполнить();
	
	Диаграмма.Обновление = Ложь;
	Диаграмма.Очистить();
	Диаграмма.АвтоТранспонирование = Ложь;
	
	ВыборкаНоменклатура = РезультатЗапроса.Выбрать(ОбходРезультатаЗапроса.ПоГруппировкам);
	Пока ВыборкаНоменклатура.Следующий() Цикл
		Серия = Диаграмма.УстановитьСерию(ВыборкаНоменклатура.Номенклатура);
		Серия.Текст = ВыборкаНоменклатура.НоменклатураПредставление;
		Серия.Расшифровка = ВыборкаНоменклатура.Номенклатура;
	
		ВыборкаКонтрагент = ВыборкаНоменклатура.Выбрать(ОбходРезультатаЗапроса.ПоГруппировкам);
		Пока ВыборкаКонтрагент.Следующий() Цикл
			Точка = Диаграмма.УстановитьТочку(ВыборкаКонтрагент.Контрагент);
			Точка.Текст = ВыборкаКонтрагент.КонтрагентПредставление;
			Точка.Расшифровка = ВыборкаКонтрагент.Контрагент;
			Диаграмма.УстановитьЗначение(Точка, Серия, ВыборкаКонтрагент.СуммаОборот);
		КонецЦикла;
	КонецЦикла;
	
	Диаграмма.АвтоТранспонирование = Истина;
	Диаграмма.Обновление = Истина;

КонецПроцедуры
```