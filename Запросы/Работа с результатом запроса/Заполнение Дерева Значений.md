#ЗАПРОСЫ
### Задача:
Требуется создать обработку, которая будет показывать сумму и количество оборотов продаж товаров, в разрезе контрагентов и с итогами по контрагенам. В виде таблицы-дерево значений
![[Pasted image 20240902150534.png]]
### Решение:
1. Создаем обработку, форму обработки. Открываем редактор формы
2. Создаем реквизит "ДеревоЗначений" тип (ДеревоЗначений)
3. Создаем колонки реквизита:
- Контрагент (СправочникСсылка.Контрагенты)
- Номенклатура (СправочникСсылка.Контрагенты)
- Количество (Число, 10, 0)
- Сумма (Число, 10, 2)
4. Переносим реквизит "ДеревоЗначений" на форму со всеми колонками
![[Pasted image 20240902150042.png]]
5. Создаем команду "ЗаполнитьДеревоЗначений"
6. Переносим ее на форму и создаем обработчик действия команды
![[Pasted image 20240902150352.png]]
7. Модуль формы:
```bsl
&НаКлиенте
Процедура ЗаполнитьДеревоЗначений(Команда)
	ЗаполнитьДеревоЗначенийНаСервере();
КонецПроцедуры

&НаСервере
Процедура ЗаполнитьДеревоЗначенийНаСервере()

	Запрос = Новый Запрос;
	Запрос.Текст = 
		"ВЫБРАТЬ
		|	Продажи.Контрагент КАК					Контрагент,
		|	Продажи.Номенклатура КАК				Номенклатура,
		|	Продажи.Количество КАК					Количество,
		|	Продажи.Сумма КАК							Сумма
		|ИЗ
		|	РегистрНакопления.Продажи КАК		Продажи
		|ИТОГИ
		|	СУММА(Количество),
		|	СУММА(Сумма)
		|ПО
		|	Контрагент";
	РезультатДЗ = Запрос.Выполнить().Выгрузить(ОбходРезультатаЗапроса.ПоГруппировкам);
	
	ЗначениеВРеквизитФормы(РезультатДЗ, "ДеревоЗначений"); 	// Вариант №1
	ЗначениеВДанныеФормы(РезультатДЗ, ДеревоЗначений);		// Вариант №2

КонецПроцедуры
```
